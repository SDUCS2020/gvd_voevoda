{% extends 'base.html' %}
{% load static %} 
{% block content %}
        <!--
            –°–ò–¢–£–ê–¶–ò–Ø 1 - –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—à—å –Ω–æ–≤—ã–π –ò–í–ï–ù–¢

            –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è event_data –ø—É—Å—Ç–∞—è, —Ç–æ —Å–æ–∑–¥–∞–µ–º —Ñ–æ—Ä–º—É
                "name": –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è,
                "type": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, (–∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–ª–æ–≤–∞. 1 - –ê—Ç–∞–∫–∞, 2 - –ó–∞—â–∏—Ç–∞),
                "date": –≤—ã–±–æ—Ä –¥–∞—Ç—ã –∏ –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏,
                "enemy": –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ. –ö–æ–≥–¥–∞ –≤ –Ω–µ–≥–æ –≤–≤–æ–¥–∏—à—å —Å–∏–º–≤–æ–ª—ã (–Ω–µ –º–µ–Ω–µ–µ 3-—Ö), —Ç–æ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤ 2 —Å–µ–∫—É–Ω–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å
                  url = "http://127.0.0.1:8000/api/clans"
                  params = {
                          "clan_name": –≤–≤–µ–¥–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
                  }
                  –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª –∫–ª–∞–Ω - —Ä–µ–Ω–¥–µ—Ä–∏—à—å –µ–≥–æ –≥–∏—Ñ–∫—É –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ
            –ü–æ—Å–ª–µ —Ñ–æ—Ä–º—ã –∑–∞—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –∫–Ω–æ–ø–∫—É "–°–û–ó–î–ê–¢–¨ –ò–í–ï–ù–¢"
            –ü–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å
              url: http://127.0.0.1:8000/api/events/
              type: POST
              body: {
                  "voevoda_id": request.session.voevoda_id,
                  "date": –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π date, –∫–æ—Ç–æ—Ä—É—é –≤–≤–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—É—é –≤ timestampt
                  "enemy": id enemy –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±—Ä–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
              }
              –û–¢–í–ï–¢:
                  {
                    "id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ)
                    "name": —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, (–æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –∏ –∑–∞—à–∏—Ç—å href = {% url 'event' %}?event_id=[ID –∏–∑ –ø–æ–ª—è –≤—ã—à–µ]
                    "type": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, (–∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–ª–æ–≤–∞. 1 - –ê—Ç–∞–∫–∞, 2 - –ó–∞—â–∏—Ç–∞)
                    "date": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ timestampt, (–ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤–∏–¥—É (dd.mm.yyyy hh:mm)
                    "voevoda_id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ)
                    "enemy": {
                      "id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ)
                      "name: —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ä–µ–Ω–¥–µ—Ä–∏–º)
                      "label": url –≥–∏—Ñ–∫–∞ (–Ω—É–∂–Ω–æ –∑–∞—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å + —Å–ø—Ä—è–Ω–∞—Ç—å –ø–æ–¥ –Ω–µ–µ —Å—Å—ã–ª–∫—É href = https://www.heroeswm.ru/pl_info.php?id=[ID –∏–∑ –ø–æ–ª—è –≤—ã—à–µ])
                    },
                    "state": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (1 - "–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Å–±–æ—Ä", 2 - "–í—ã–±–æ—Ä –±–æ–π—Ü–æ–≤", 3 - "–ò–¥–µ—Ç –±–æ–π", 4 - "–ó–∞–≤–µ—Ä—à–µ–Ω")
                }
                –î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ url {% url 'event' %}?event_id=[ID –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–µ–ª –≤ –æ—Ç–≤–µ—Ç –Ω–∞ POST –∑–∞–ø—Ä–æ—Å]

            –°–ò–¢–£–ê–¶–ò–Ø 2 (–∫–æ–≥–¥–∞ –∏–≤–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –∏ state = 1)
                url: http://127.0.0.1:8000/api/persons/
                type: GET
                params: voevoda_id=request.session.voevoda_id

                –û–¢–í–ï–¢ –±—É–¥–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–π —Å–ø–∏—Å–æ–∫ JSON–æ–≤, –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ—Ö —É –∫–æ–≥–æ –ø–æ–ª–µ activity == true:
                      data: [
                        {
                                "id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                "role": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ  (1, "–í–æ–µ–≤–æ–¥–∞"),
                                                                (2, "–ü–æ–º–æ—â–Ω–∏–∫ –≤–æ–µ–≤–æ–¥—ã"),
                                                                (100, "–ò–≥—Ä–æ–∫"),  –ù—É–∂–Ω–æ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —á–∏—Å–ª–æ –≤ —Å—Ç—Ä–æ–∫—É
                                "telegram_id": —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                "telegram_username": —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                "voevoda_id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, - –†–µ–Ω–¥–µ—Ä–∏–Ω –Ω–µ –Ω—É–∂–Ω–æ
                                "activity": bool –∑–Ω–∞—á–µ–Ω–∏–µ, (–∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –≥–∞–ª–æ—á–∫—É –∏–ª–∏ –∫—Ä–µ—Å—Ç–∏–∫)
                                "comment": —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                "stats": {
                                        "id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "name": —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Å–ø—Ä—è—Ç–∞—Ç—å —Å—Å—ã–ª–∫—É https://www.heroeswm.ru/pl_info.php?id=[ID –∏–∑ –ø–æ–ª—è –≤—ã—à–µ],
                                        "level": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "clan": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, - –µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
                                        "umka_knight": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "umka_necro": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "umka_mag": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "umka_elf": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "umka_barbar": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "umka_black_elf": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "umka_demon": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "umka_dwarf": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "umka_step_barb": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "umka_pharaon": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_hunt": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_work": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_card": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_thief": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_ranger": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_mers": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_tactic": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_gard": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_seekers": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_leader": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_blacksmith": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                        "gild_gunsmith": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                },
                                "presets": [
                                        {
                                          "id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, - —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
                                          "voevoda_id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, - —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
                                          "fraction": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, (0, "–†—ã—Ü–∞—Ä—å"),
                                                                              (1, "–ù–µ–∫—Ä–æ–º–∞–Ω—Ç"),
                                                                              (2, "–ú–∞–≥"),
                                                                              (3, "–≠–ª—å—Ñ"),
                                                                              (4, "–í–∞—Ä–≤–∞—Ä"),
                                                                              (5, "–¢–µ–º–Ω—ã–π —ç–ª—å—Ñ"),
                                                                              (6, "–î–µ–º–æ–Ω"),
                                                                              (7, "–ì–Ω–æ–º"),
                                                                              (8, "–°—Ç–µ–ø–Ω–æ–π –≤–∞—Ä–≤–∞—Ä"),
                                                                              (9, "–§–∞—Ä–∞–æ–Ω"), - –Ω—É–∂–Ω–æ –∏–∑ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å —Å—Ç—Ä–æ–∫—É
                                          "name": —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,  –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ø—Ä—è—Ç–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ url –Ω–∏–∂–µ, –≥–¥–µ preset_id = ID –≤—ã—à–µ
                                          "description": —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω—ã–º)
                                          play_preset: bool –∑–Ω–∞—á–µ–Ω–∏–µ, —Å—Ç–∞–≤–∏–º –≥–∞–ª–æ—á–∫—É –∏–ª–∏ –∫—Ä–µ—Å—Ç–∏–∫
                                ]

                –ï–°–õ–ò type –∏–≤–µ–Ω—Ç–∞  == 1 (–∞—Ç–∞–∫–∞), —Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                –ï—Å–ª–∏ type –∏–≤–µ–Ω—Ç–∞ == 2 (–∑–∞—â–∏—Ç–∞), —Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ —É –∫–æ—Ç–æ—Ä—ã—Ö stats.clan == request.session.clan_id

                –ù–ê–ü–†–û–¢–ò–í –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —Å—Ç–∞–≤–∏–º –ø–æ–ª–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≥–∞–ª–æ—á–∫—É (–û–¢–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ)

                –°–ù–ò–ó–£ –î–ï–õ–ê–ï–ú –ö–ù–û–ü–ö–£ "–û–¢–ü–†–ê–í–ò–¢–¨ –ü–†–ò–ì–õ–ê–®–ï–ù–ò–ï"
                –ü–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –∫–Ω–æ–ø–∫—É —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –≥–∞–ª–æ—á–∫–∞–º–∏ –∏ –≤ —Ü–∏–∫–ª–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∑–∞–ø—Ä–æ—Å—ã

                url: http://127.0.0.1:8000/api/invites/
                type: POST
                body: {
                    "event_id": ID –∏–≤–µ–Ω—Ç–∞ –≤—ã—à–µ
                    "person_id": –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–Ω–∞–ø—Ä–æ—Ç–∏–≤ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –≥–∞–ª–æ—á–∫—É)
                }

                –î–∞–ª–µ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
                url: http://127.0.0.1:8000/api/events/
                type: PATCH
                body: {
                    "event_id": ID –∏–≤–µ–Ω—Ç–∞,
                    "state": 2
                }

                –î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ url {% url 'event' %}?event_id=[ID –∏–≤–µ–Ω—Ç–∞ –±–µ—Ä–µ–º –≤—ã—à–µ]

            –°–ò–¢–£–ê–¶–ò–Ø 3 - state == 2
                –†–µ–Ω–¥–µ—Ä–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≤–µ–Ω—Ç–µ

                –í—ã–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤ –∫–æ—Ç–æ—Ä—ã–º –±—ã–ª–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ

                –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å:
                url: http://127.0.0.1:8000/api/invites/
                type: GET
                params = {
                    "event_id": ID –∏–≤–µ–Ω—Ç–∞
                }

                –û–¢–í–ï–¢ JSON —Å–æ —Å–ø–∏—Å–∫–æ–º
                [
                  {
                    "id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ),
                    "date": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ),
                    "event_id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ),
                    "person_id": –î–∞–Ω–Ω—ã–µ –æ –ø–µ—Ä—Å–Ω–∞–∂–µ –∫–∞–∫ –≤ —Å–∏—Ç—É–∞—Ü–∏–∏ ‚Ññ3,
                    "state": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏ (–∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ 1 - "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ", 2 - "–ü—Ä–∏–Ω—è—Ç–æ", 3 - "–û—Ç–∫–∞–∑", 4 - "–í—ã–±—Ä–∞–Ω –Ω–∞ –±–æ–π")
                  }
                ]

                –î–∞–ª–µ–µ –≤—ã–≥—Ä—É–∂–∞–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞

                –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
                url: http://127.0.0.1:8000/api/players/
                type: GET
                params: clan_id={{ clan_id }}

                –û–¢–í–ï–¢:
                data: [
                        {
                            "id": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "name": —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Å–ø—Ä—è—Ç–∞—Ç—å —Å—Å—ã–ª–∫—É https://www.heroeswm.ru/pl_info.php?id=[ID –∏–∑ –ø–æ–ª—è –≤—ã—à–µ],
                            "level": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "clan": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, - –µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
                            "umka_knight": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "umka_necro": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "umka_mag": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "umka_elf": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "umka_barbar": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "umka_black_elf": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "umka_demon": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "umka_dwarf": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "umka_step_barb": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "umka_pharaon": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_hunt": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_work": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_card": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_thief": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_ranger": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_mers": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_tactic": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_gard": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_seekers": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_leader": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_blacksmith": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                            "gild_gunsmith": —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                        }
                    ]

             –ï—Å–ª–∏ —Ç–∏–ø –∏–≤–µ–Ω—Ç–∞ == 2 (–∑–∞—â–∏—Ç–∞), —Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
             –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã
             1) url: http://127.0.0.1:8000/api/clans/
                type: GET
                params: clan_id=enemy.id

                –û–¢–í–ï–¢:
                data: {
                        "id": –¶–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                        "name": –°—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                        "label": url –∞–¥—Ä–µ—Å –≥–∏—Ñ–∫–∏, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å + –ø–æ–¥ –≥–∏—Ñ–∫—É —Å–ø—Ä—è—Ç–∞—Ç—å —Å—Å—ã–ª–∫—É https://www.heroeswm.ru/clan_info.php?id=[ID –∏–∑ –ø–æ–ª—è –≤—ã—à–µ],
                        "alliance": null –∏–ª–∏ {
                                "id": –¶–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                "name": –°—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,
                                "label": url –∞–¥—Ä–µ—Å –≥–∏—Ñ–∫–∏, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å + –ø–æ–¥ –≥–∏—Ñ–∫—É —Å–ø—Ä—è—Ç–∞—Ç—å —Å—Å—ã–ª–∫—É https://www.heroeswm.ru/clan_info.php?id=[ID –∏–∑ –ø–æ–ª—è –≤—ã—à–µ]
                         }
                }

               –ï—Å–ª–∏ –ø–æ–ª–µ alliance –Ω–µ —Ä–∞–≤–Ω–æ –Ω—É–ª—é, —Ç–æ –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å

               url: http://127.0.0.1:8000/api/players/
              type: GET
              params: clan_id=alliance.id

            –ë–û–ò –ü–†–û–•–û–î–Ø–¢ 2 –Ω–∞ 2

            –°–æ–∑–¥–∞–µ–º –ø–æ 2 –ø–æ–ª—è –¥–ª—è —Å—Ç–æ—Ä–æ–Ω—ã –∞—Ç–∞–∫–∏ –∏ –∑–∞—â–∏—Ç—ã

            –ù–∞–ø—Ä–æ—Ç–∏–≤ –∫–∞–∂–¥–æ–≥–æ –∏–∑ –ø–æ–ª–µ–π —Å–¥–µ–ª–∞—Ç—å –µ—â–µ –æ–¥–Ω–æ —Å –≤—ã–±–æ—Ä–æ–º —É—Ä–æ–≤–Ω—è. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã–±–∏—Ä–∞–µ–º —É—Ä–æ–≤–µ–Ω—å,
            –ø—Ä–æ–≤–æ–¥–∏—à—å —Ñ–∏–ª—å—Ç—Ä –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å—Ç–æ—Ä–æ–Ω—ã –ø–æ –ø–æ–ª—é "level" –∏ –¥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±—Ä–∞—Ç—å –∏–≥—Ä–æ–∫–∞


            –†–ï–ù–î–ï–†–ò–ú –ö–ù–û–ü–ö–£ "–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –ù–ê –ë–û–ô"
            –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª –∏–≥—Ä–æ–∫–æ–≤ —Å–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω—ã –≤ –ø–æ–ª—è—Ö –≤—ã—à–µ - –Ω–∞–∂–∏–º–∞–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É
            –∏ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∏–≥—Ä–æ–∫–∞–º —Å–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∑–∞–ø—Ä–æ—Å—ã

            –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å:
                url: http://127.0.0.1:8000/api/invites/
                type: POST
                params = {
                    "event_id": ID –∏–≤–µ–Ω—Ç–∞,
                    "state": 4
                }

            –û–±–Ω–æ–≤–ª—è–µ–º –∏–≤–µ–Ω—Ç
              url: http://127.0.0.1:8000/api/events/
              type: PATCH
              body: {
                  "event_id": ID –∏–≤–µ–Ω—Ç–∞,
                  "state": 3
              }

             –î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ url {% url 'event' %}?event_id=[ID –∏–≤–µ–Ω—Ç–∞ –±–µ—Ä–µ–º –≤—ã—à–µ]

         –°–ò–¢–£–ê–¶–ò–Ø 4 - state == 3 (–ò–¥–µ–Ω—Ç –±–æ–π)

         –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –ò–í–ï–ù–¢–ï

          –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
          url: http://127.0.0.1:8000/api/invites/
          type: GET
          params = {
              "event_id": ID –∏–≤–µ–Ω—Ç–∞,
              "state__in": 4
          }

          –í–ù–ò–ó–£ –ï–°–¢–¨ –ö–ù–û–ü–ö–ê "–ó–ê–í–ï–†–®–ò–¢–¨"

          –ü–æ–Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
          url: http://127.0.0.1:8000/api/events/
          type: PATCH
          body: {
              "event_id": ID –∏–≤–µ–Ω—Ç–∞,
              "state": 4
          }

          –ò –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º redirect
          "{% url 'fight' %}?event_id=[ID –∏–≤–µ–Ω—Ç–∞]"

        -->
        <div class="sh_MenuPanel" style="width: 10px;">
            <div class="mm_l"></div>
            <div class="mm_r"></div>
            <a href="{% url 'main' %}">
                <img src="{% static 'voevoda_app/images/arrow.png' %}" href="{% url 'main' %}" class="cursor_main_menu">
            </a>
            <div class="main_menu" hwm_label=""><a href="{% url 'events' %}">–ò–≤–µ–Ω—Ç—ã</a></div>
            <div class="not_auth_text_on_buttons2">–ò–≤–µ–Ω—Ç—ã</div>
        </div>

        {% if not event_data %}
        <form id="event-form" class="form-container">
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–≤–µ–Ω—Ç–∞</h2>
            
            <label for="event-name">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
            <input type="text" id="event-name" name="name" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è">

            <label for="event-type">–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:</label>
            <select id="event-type" name="type" required>
                <option value="1">‚öîÔ∏è –ê—Ç–∞–∫–∞</option>
                <option value="2">üõ°Ô∏è –ó–∞—â–∏—Ç–∞</option>
            </select>

            <label for="event-date">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</label>
            <input type="datetime-local" id="event-date" name="date" style="width: 97%" required>

            <label for="event-enemy">–í—Ä–∞–≥:</label>
            <input type="text" id="event-enemy" name="enemy" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∞–Ω–∞..." list="clanList" autocomplete="off">
            <datalist id="clanList"></datalist>
            <div id="enemy-details"></div>

            <button type="submit" id="create-event">–°–æ–∑–¥–∞—Ç—å –∏–≤–µ–Ω—Ç</button>
        </form>
    
        <script>
            let clanSearchTimeout;
            let selectedEnemyId = null;
            const inputField = document.getElementById('event-enemy');
            const clanList = document.getElementById('clanList');
            const enemyDetails = document.getElementById('enemy-details');
    
            inputField.addEventListener('input', function() {
                clearTimeout(clanSearchTimeout);
                const query = this.value;

                if (query.length >= 3) {
                    clanSearchTimeout = setTimeout(() => {
                        fetch(`http://127.0.0.1:8000/api/clans/?clan_name=${encodeURIComponent(query)}`)
                            .then(response => response.json())
                            .then(data => {
                                clanList.innerHTML = '';
                                data.data.forEach(enemy => {
                                    const option = document.createElement('option');
                                    option.value = enemy.name;
                                    option.dataset.id = enemy.id;
                                    clanList.appendChild(option);
                                });
                            });
                    }, 500);
                }
            });

            inputField.addEventListener('change', function() {
                const selectedOption = Array.from(clanList.options).find(option => option.value === this.value);
                if (selectedOption) {
                    selectedEnemyId = selectedOption.dataset.id;
                    fetch(`http://127.0.0.1:8000/api/clans/?clan_id=${selectedEnemyId}`)
                        .then(response => response.json())
                        .then(enemy => {
                            enemyDetails.innerHTML = `
                            <p><img src="${enemy.data.label}" alt="–í—Ä–∞–≥" style="width:20px;"/>
                                ${enemy.data.name}</p>
                            `;
                        });
                    fetch(`http://127.0.0.1:8000/api/events/?event_id=2`)
                        .then(response => response.json())
                        .then(enemy => {
                            console.log(enemy);
                        });
                } else {
                    selectedEnemyId = null;
                }
            });
    
            document.getElementById('create-event').addEventListener('click', function() {
                const name = document.getElementById('event-name').value;
                const type = document.getElementById('event-type').value;
                const date = new Date(document.getElementById('event-date').value).getTime()/1000;
    
                fetch('http://127.0.0.1:8000/api/events/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        voevoda_id: "{{ request.session.voevoda_id }}",
                        name: name,
                        type: type,
                        date: date,
                        enemy: selectedEnemyId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    window.location.href = `{% url 'event' %}?event_id=${data.data.id}`;
                });
            });
        </script>
    
    {% else %}
        <div class="event-state-container">
            <h3 class="event-title">{{ event_data.name }}</h3>
            <p class="event-info">–¢–∏–ø:
                {% if event_data.type == 1 %}
                    <span class="icon-attack">–ê—Ç–∞–∫–∞</span>
                {% elif event_data.type == 2 %}
                    <span class="icon-defense">–ó–∞—â–∏—Ç–∞</span>
                {% else %}
                    <span class="event-type-unknown">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                {% endif %}
            </p>
            <p class="event-info" id="event-data" data-timestamp="{{ event_data.date }}">–î–∞—Ç–∞: </p>
            <p class="event-info">–°–æ—Å—Ç–æ—è–Ω–∏–µ:
                {% if event_data.state == 1 %}
                    <span class="status-1">–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Å–±–æ—Ä</span>
                {% elif event_data.state == 2 %}
                    <span class="status-2">–í—ã–±–æ—Ä –±–æ–π—Ü–æ–≤</span>
                {% elif event_data.state == 3 %}
                    <span class="status-3">–ò–¥–µ—Ç –±–æ–π</span>
                {% elif event_data.state == 4 %}
                    <span class="status-4">–ó–∞–≤–µ—Ä—à–µ–Ω</span>
                {% else %}
                    –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                {% endif %}
            </p>

            <script>
                function formatDate(timestamp) {
                    const date = new Date(timestamp * 1000); 
                    const day = String(date.getDate()).padStart(2, '0');
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const year = date.getFullYear();
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    return `${day}.${month}.${year} ${hours}:${minutes}`;
                }
                
                const activeEventsDiv = document.getElementById('event-data');
                const timestamp = activeEventsDiv.getAttribute('data-timestamp');
                activeEventsDiv.textContent = `–î–∞—Ç–∞: ${formatDate(timestamp)}`;
                console.log(`–î–∞—Ç–∞: ${formatDate(timestamp)}`);
            </script>

            {% if event_data.state == 1 %}
            <div class="invite-section">
                <h4>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h4>
                <form id="invite-form">
                    <div id="players-list" class="players-list"></div>
                    <button type="submit" id="send-invites" style="width:30%; margin: 10px auto;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</button>
                </form>
            </div>


            <script>
                const clanId = "{{ request.session.clan_id }}";
                fetch(`http://127.0.0.1:8000/api/persons/?voevoda_id={{ request.session.voevoda_id }}`)
                    .then(response => response.json())
                    .then(data => {
                        const activePlayers = data.data.filter(person => person.activity);
                        const playersList = document.getElementById('players-list');
                        activePlayers.forEach(person => {
                            const personRole = (person.role === 1) ? "–í–æ–µ–≤–æ–¥–∞" :
                                            (person.role === 2) ? "–ü–æ–º–æ—â–Ω–∏–∫ –≤–æ–µ–≤–æ–¥—ã" :
                                            (person.role === 100) ? "–ò–≥—Ä–æ–∫" : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å";
                            const personHtml = `
                                <div class="player-card">
                                    <input type="checkbox" id="person-${person.id}" name="person" value="${person.id}">
                                    <label for="person-${person.id}">
                                        ${person.telegram_username} - ${personRole}
                                        <span class="player-stats">${person.stats.name} (${person.stats.level} —É—Ä–æ–≤–µ–Ω—å)</span>
                                    </label>
                                </div>
                            `;
                            playersList.insertAdjacentHTML('beforeend', personHtml);
                        });
                        document.getElementById('send-invites').disabled = false;
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤:', error);
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤.');
                    });
            
                document.getElementById('send-invites').addEventListener('click', function() {
                    const selectedPersons = Array.from(document.querySelectorAll('input[name="person"]:checked'))
                        .map(input => input.value);
                    const sendInvitesButton = document.getElementById('send-invites');
                    sendInvitesButton.disabled = true;
                    sendInvitesButton.innerText = "–û—Ç–ø—Ä–∞–≤–∫–∞...";
                    const sendInvitations = selectedPersons.map(personId => {
                        return fetch('http://127.0.0.1:8000/api/invites/', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                event_id: "{{ event_data.id }}",
                                person_id: personId
                            })
                        });
                    });
                    Promise.all(sendInvitations)
                        .then(() => {
                            return fetch('http://127.0.0.1:8000/api/events/', {
                                method: 'PATCH',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    event_id: "{{ event_data.id }}",
                                    state: 2
                                })
                            });
                        })
                        .then(() => {
                            window.location.href = `{% url 'event' %}?event_id={{ event_data.id }}`;
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è:', error);
                            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                        });
                });
            </script>
            </div>
            {% endif %}

            {% if event_data.state == 2 %}
            <div>
            <div class="invite-section">
                <h4 class="section-title">–ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏</h4>
                <div id="invited-players-list" class="players-list"></div>
    
                <h4 class="section-title">–ò–≥—Ä–æ–∫–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</h4>
                <div id="enemy-players-list" class="players-list"></div>
    
                {% if event_data.type == 2 %}
    
                    <div id="enemy-alliance-players-container" class="alliance-players-container"></div>
                {% endif %}
    
                <div class="clan-section">
                    <div class="clan-attack">
                        <h4>–ö–ª–∞–Ω –∞—Ç–∞–∫–∏</h4>
                        <div id="attack-clan-info" class="e-clan-info"></div>
                    </div>
                    <div class="clan-defense">
                        <h4>–ö–ª–∞–Ω –∑–∞—â–∏—Ç—ã</h4>
                        <div id="defense-clan-info" class="e-clan-info"></div>
                    </div>
                </div>
                
                <h4 class="section-title">–í—ã–±–æ—Ä –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –±–æ—è</h4>
                <div class="player-selection-container">
                    {% if event_data.type == 1 %}
                        <div class="row">
                            <div class="player-select-container">
                                <label>–ê—Ç–∞–∫–∞ - –ò–≥—Ä–æ–∫ 1:</label>
                                <select id="attacker-1-level" onchange="filterPlayers('attacker-1', this.value, 'my')" class="level-select"></select>
                                <select id="attacker-1" class="player-select"></select>
                            </div>
                            <div class="player-select-container">
                                <label>–ê—Ç–∞–∫–∞ - –ò–≥—Ä–æ–∫ 2:</label>
                                <select id="attacker-2-level" onchange="filterPlayers('attacker-2', this.value, 'my')" class="level-select"></select>
                                <select id="attacker-2" class="player-select"></select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="player-select-container">
                                <label>–ó–∞—â–∏—Ç–∞ - –ò–≥—Ä–æ–∫ 1:</label>
                                <select id="defender-1-level" onchange="filterPlayers('defender-1', this.value, 'enemy')" class="level-select"></select>
                                <select id="defender-1" class="player-select"></select>
                            </div>
                            <div class="player-select-container">
                                <label>–ó–∞—â–∏—Ç–∞ - –ò–≥—Ä–æ–∫ 2:</label>
                                <select id="defender-2-level" onchange="filterPlayers('defender-2', this.value, 'enemy')" class="level-select"></select>
                                <select id="defender-2" class="player-select"></select>
                            </div>
                        </div>
                    {% elif event_data.type == 2 %}
                        <div class="row">
                            <div class="player-select-container">
                                <label>–ó–∞—â–∏—Ç–∞ - –ò–≥—Ä–æ–∫ 1:</label>
                                <select id="defender-1-level" onchange="filterPlayers('defender-1', this.value, 'my')" class="level-select"></select>
                                <select id="defender-1" class="player-select"></select>
                            </div>
                            <div class="player-select-container">
                                <label>–ó–∞—â–∏—Ç–∞ - –ò–≥—Ä–æ–∫ 2:</label>
                                <select id="defender-2-level" onchange="filterPlayers('defender-2', this.value, 'my')" class="level-select"></select>
                                <select id="defender-2" class="player-select"></select>
                            </div>
                        </div>
                
                        <div class="row">
                            <div class="player-select-container">
                                <label>–ê—Ç–∞–∫–∞ - –ò–≥—Ä–æ–∫ 1:</label>
                                <select id="attacker-1-level" onchange="filterPlayers('attacker-1', this.value, 'enemy')" class="level-select"></select>
                                <select id="attacker-1" class="player-select"></select>
                            </div>
                            <div class="player-select-container">
                                <label>–ê—Ç–∞–∫–∞ - –ò–≥—Ä–æ–∫ 2:</label>
                                <select id="attacker-2-level" onchange="filterPlayers('attacker-2', this.value, 'enemy')" class="level-select"></select>
                                <select id="attacker-2" class="player-select"></select>
                            </div>
                        </div>
                    {% endif %}
                </div>
                
    
                <button type="submit" id='invite-to-fight' style="width: auto; margin: 20px auto;">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –Ω–∞ –±–æ–π</button>

                <script>
                    const eventId = "{{ event_data.id }}";
                    let myPlayers = [];  
                    let enemyPlayers = []; 

                    function filterPlayers(selectId, selectedLevel, team) {
                        const selectElement = document.getElementById(selectId);
                        selectElement.innerHTML = '';

                        const playersToFilter = team === 'my' ? myPlayers : enemyPlayers;

                        playersToFilter.forEach(player => {
                            const playerName = team === 'my' ? player.stats.name : player.name;
                            const playerLevel = team === 'my' ? player.stats.level : player.level;

                            if (playerLevel == selectedLevel) {
                                const optionHtml = `<option value="${player.id}">${playerName} (${playerLevel} —É—Ä–æ–≤–µ–Ω—å)</option>`;
                                selectElement.insertAdjacentHTML('beforeend', optionHtml);
                            }
                        });

                        if (selectElement.options.length > 0) {
                            selectElement.options[0].selected = true;
                        }
                    }

                    function updateLevelAndPlayers(selectId, team) {
                        const levelSelect = document.getElementById(selectId + '-level');
                        const firstLevel = levelSelect.options[0]?.value;

                        if (firstLevel) {
                            filterPlayers(selectId, firstLevel, team);
                        }
                    }

                    function fetchClanData(type, clanId) {
                        console.log(clanId);
                        fetch(`http://127.0.0.1:8000/api/clans/?clan_id=${clanId}`)
                            .then(response => response.json())
                            .then(data => {
                                const clanContainer = document.getElementById(type + '-clan-info');

                                const clanLink = document.createElement('a');
                                clanLink.href = `https://www.heroeswm.ru/clan_info.php?id=${data.data.id}`;
                                clanLink.target = '_blank';

                                const clanImage = document.createElement('img');
                                clanImage.src = data.data.label;
                                clanImage.alt = data.data.name;

                                const clanName =  document.createElement('span');
                                clanName.textContent = data.data.name;

                                clanLink.appendChild(clanImage);
                                clanLink.appendChild(clanName);
                                clanContainer.appendChild(clanLink);

                                if (data.data.alliance) {
                                    const allianceLink = document.createElement('a');
                                    allianceLink.href = `https://www.heroeswm.ru/clan_info.php?id=${data.data.alliance.id}`;
                                    allianceLink.target = '_blank';

                                    const allianceImage = document.createElement('img');
                                    allianceImage.src = data.data.alliance.label;
                                    allianceImage.alt = data.data.alliance.name;

                                    const allianceClanName =  document.createElement('span');
                                    allianceClanName.textContent = data.data.alliance.name;

                                    allianceLink.appendChild(allianceImage);
                                    allianceLink.appendChild(allianceClanName);
                                    clanContainer.appendChild(allianceLink);
                                }
                            })
                            .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞–Ω–∞:', error));
                    }

                    fetch(`http://127.0.0.1:8000/api/events/?event_id=${eventId}`)
                        .then(response => response.json())
                        .then(eventData => {
                            const eventType = eventData.data.type;

                            fetch('http://127.0.0.1:8000/api/invites/?event_id=' + eventId)
                                .then(response => response.json())
                                .then(data => {
                                    const invitedPlayersList = document.getElementById('invited-players-list');
                                    let myLevels = new Set();

                                    data.data.forEach(invite => {
                                        myPlayers.push(invite.person_id);

                                        const playerState = invite.state === 1 ? "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ" :
                                                            invite.state === 2 ? "–ü—Ä–∏–Ω—è—Ç–æ" :
                                                            invite.state === 3 ? "–û—Ç–∫–∞–∑" :
                                                            invite.state === 4 ? "–í—ã–±—Ä–∞–Ω –Ω–∞ –±–æ–π" : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";

                                        const playerHtml = `
                                            <div>
                                                &nbsp&nbsp&nbsp${invite.person_id.stats.name} (${invite.person_id.stats.level} —É—Ä–æ–≤–µ–Ω—å) - ${playerState}
                                            </div>
                                        `;
                                        invitedPlayersList.insertAdjacentHTML('beforeend', playerHtml);

                                        myLevels.add(invite.person_id.stats.level);
                                    });

                                    const levelSelects = eventType === 1 ? ['attacker-1-level', 'attacker-2-level'] : ['defender-1-level', 'defender-2-level'];
                                    levelSelects.forEach(selectId => {
                                        const selectElement = document.getElementById(selectId);
                                        myLevels.forEach(level => {
                                            const levelOption = `<option value="${level}">${level}</option>`;
                                            selectElement.insertAdjacentHTML('beforeend', levelOption);
                                        });

                                        updateLevelAndPlayers(selectId.replace('-level', ''), 'my');
                                    });
                                });

                            fetch('http://127.0.0.1:8000/api/players/?clan_id=' + eventData.data.enemy.id)
                                .then(response => response.json())
                                .then(data => {
                                    const enemyPlayersList = document.getElementById('enemy-players-list');
                                    enemyPlayers = data.data; 
                                    let enemyLevels = new Set(); 

                                    data.data.forEach(player => {
                                        const playerHtml = `
                                            <div>
                                                &nbsp&nbsp&nbsp${player.name} (${player.level} —É—Ä–æ–≤–µ–Ω—å)
                                            </div>
                                        `;
                                        enemyPlayersList.insertAdjacentHTML('beforeend', playerHtml);

                                        enemyLevels.add(player.level);
                                    });
                                    
                                    const enemyLevelSelects = eventType === 1 ? ['defender-1-level', 'defender-2-level'] : ['attacker-1-level', 'attacker-2-level'];
                                    enemyLevelSelects.forEach(selectId => {
                                        const selectElement = document.getElementById(selectId);
                                        enemyLevels.forEach(level => {
                                            const levelOption = `<option value="${level}">${level}</option>`;
                                            selectElement.insertAdjacentHTML('beforeend', levelOption);
                                        });

                                        updateLevelAndPlayers(selectId.replace('-level', ''), 'enemy');
                                    });
                                });
                            if (eventType === 2) {
                                fetchClanData('attack', "{{ request.session.clan_id }}"); 
                                fetchClanData('defense', eventData.data.enemy.id); 
                                fetch('http://127.0.0.1:8000/api/clans/?clan_id=' + eventData.data.enemy.id)
                                    .then(response => response.json())
                                    .then(clanData => {
                                        if (clanData.data.alliance) {
                                            
                                            const enemyAlliancePlayersContainer = document.getElementById('enemy-alliance-players-container');

                                            const allianceHeader = `<h4>–°–æ—é–∑–Ω–∏–∫–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</h4>`;
                                            enemyAlliancePlayersContainer.insertAdjacentHTML('beforeend', allianceHeader);

                                            const enemyAlliancePlayersList = `<div id="enemy-alliance-players-list" class="players-list"></div>`;
                                            enemyAlliancePlayersContainer.insertAdjacentHTML('beforeend', enemyAlliancePlayersList);

                                            fetch('http://127.0.0.1:8000/api/players/?clan_id=' + clanData.data.alliance.id)
                                                .then(response => response.json())
                                                .then(allianceData => {
                                                    let allianceLevels = new Set(); 
                                                    const enemyAlliancePlayersListElement = document.getElementById('enemy-alliance-players-list');
                                                    allianceData.data.forEach(player => {
                                                        const playerHtml = `
                                                            <div>
                                                                &nbsp&nbsp&nbsp${player.name} (${player.level} —É—Ä–æ–≤–µ–Ω—å)
                                                            </div>
                                                        `;
                                                        enemyAlliancePlayersListElement.insertAdjacentHTML('beforeend', playerHtml);

                                                        allianceLevels.add(player.level);

                                                        enemyPlayers.push(player);  
                                                    });

                                                    const enemyLevelSelects = eventType === 1 ? ['defender-1-level', 'defender-2-level'] : ['attacker-1-level', 'attacker-2-level'];
                                                    enemyLevelSelects.forEach(selectId => {
                                                        const selectElement = document.getElementById(selectId);
                                                        allianceLevels.forEach(level => {
                                                            const levelOption = `<option value="${level}">${level}</option>`;
                                                            selectElement.insertAdjacentHTML('beforeend', levelOption);
                                                        });

                                                        updateLevelAndPlayers(selectId.replace('-level', ''), 'enemy');
                                                    });
                                                });
                                        }
                                    });
                            }
                            else{
                                fetchClanData('attack', eventData.data.enemy.id); 
                                fetchClanData('defense', "{{ request.session.clan_id }}"); 
                            }
                        });

                    document.getElementById('invite-to-fight').addEventListener('click', function() {
                        const attacker1 = document.getElementById('attacker-1').value;
                        const attacker2 = document.getElementById('attacker-2').value;
                        const defender1 = document.getElementById('defender-1').value;
                        const defender2 = document.getElementById('defender-2').value;

                        const inviteFight = (playerId) => {
                            return fetch('http://127.0.0.1:8000/api/invites/', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    event_id: eventId,
                                    person_id: playerId,
                                    state: 4 
                                })
                            });
                        };

                        Promise.all([
                            inviteFight(attacker1),
                            inviteFight(attacker2),
                            inviteFight(defender1),
                            inviteFight(defender2)
                        ])
                        .then(() => {
                            return fetch('http://127.0.0.1:8000/api/events/', {
                                method: 'PATCH',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    event_id: eventId,
                                    state: 3
                                })
                            });
                        })
                        .then(() => {
                            window.location.href = `{% url 'event' %}?event_id=${eventId}`;
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –Ω–∞ –±–æ–π:', error);
                            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                        });
                    });
                </script>
                            </div>
            </div>
        {% endif %}
        {% if event_data.state == 3 %}
        <div class="invite-section">
        <h4>–ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏:</h4>
        <div id="invited-players-list"></div>

            <button type="submit" id="finish-button" style="width: auto; margin: 30px auto;">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
            </div>

        <script>

        const eventId = "{{ event_data.id }}"; 

        fetch('http://127.0.0.1:8000/api/invites/?event_id=' + eventId)
            .then(response => response.json())
            .then(data => {
                console.log(data); 
                const invitedPlayersList = document.getElementById('invited-players-list');
                invitedPlayersList.innerHTML = ''; 

                const selectedInvites = data.data.filter(invite => invite.state === 4);

                selectedInvites.forEach(invite => {
                    const playerHtml = `
                        <div>
                            ${invite.person_id.stats.name} (${invite.person_id.stats.level} —É—Ä–æ–≤–µ–Ω—å) - –í—ã–±—Ä–∞–Ω –Ω–∞ –±–æ–π
                        </div>
                    `;
                    invitedPlayersList.insertAdjacentHTML('beforeend', playerHtml);
                });
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error); 
            });


            document.getElementById('finish-button').addEventListener('click', function() {
                fetch('http://127.0.0.1:8000/api/events/', {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        event_id: eventId,
                        state: 4
                    })
                })
                .then(() => {
                    window.location.href = "{% url 'fight' %}?event_id=" + eventId;
                });
            });
        </script>
        
        {% endif %}

    {% endif %}
{% endblock %}